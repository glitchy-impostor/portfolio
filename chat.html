<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat with Krish's Assistant</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="icon" href="/favicon.png" type="image/x-icon"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-deep: #0a0a0c;
      --bg-surface: #141418;
      --bg-elevated: #1c1c22;
      --bg-input: #252530;
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #52525b;
      --accent-green: #10b981;
      --accent-green-dim: rgba(16, 185, 129, 0.15);
      --border-subtle: rgba(255, 255, 255, 0.08);
      --error: #ef4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Background effects */
    .bg-gradient {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      background: 
        radial-gradient(ellipse at 30% 20%, rgba(16, 185, 129, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(16, 185, 129, 0.04) 0%, transparent 50%);
    }

    .noise {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0.03;
      background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    /* Header */
    .header {
      position: relative;
      z-index: 10;
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(10, 10, 12, 0.8);
      backdrop-filter: blur(10px);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.9rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .back-btn:hover {
      color: var(--text-primary);
      background: var(--bg-elevated);
    }

    .back-btn svg {
      width: 18px;
      height: 18px;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      background: var(--accent-green);
      border-radius: 50%;
      box-shadow: 0 0 10px var(--accent-green);
      animation: pulse-dot 2s ease-in-out infinite;
    }

    @keyframes pulse-dot {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .header-title h1 {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .header-subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Main chat container */
    .chat-container {
      position: relative;
      z-index: 10;
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* Messages area */
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 2rem 0;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .messages::-webkit-scrollbar {
      width: 6px;
    }

    .messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .messages::-webkit-scrollbar-thumb {
      background: var(--bg-elevated);
      border-radius: 3px;
    }

    /* Message bubbles */
    .message {
      display: flex;
      gap: 1rem;
      animation: fadeInUp 0.3s ease;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .message.assistant .message-avatar {
      background: var(--accent-green-dim);
      color: var(--accent-green);
    }

    .message.user .message-avatar {
      background: var(--bg-elevated);
      color: var(--text-secondary);
    }

    .message-avatar svg {
      width: 20px;
      height: 20px;
    }

    .message-content {
      max-width: 70%;
    }

    .message-bubble {
      padding: 1rem 1.25rem;
      border-radius: 16px;
      line-height: 1.6;
      font-size: 0.95rem;
    }

    .message.assistant .message-bubble {
      background: var(--bg-elevated);
      border-bottom-left-radius: 4px;
    }

    .message.user .message-bubble {
      background: var(--accent-green);
      color: #000;
      border-bottom-right-radius: 4px;
    }

    .message-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
      padding: 0 0.5rem;
    }

    .message.user .message-meta {
      text-align: right;
    }

    /* Typing indicator */
    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 1rem 1.25rem;
      background: var(--bg-elevated);
      border-radius: 16px;
      border-bottom-left-radius: 4px;
      width: fit-content;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: var(--text-muted);
      border-radius: 50%;
      animation: typing 1.4s ease-in-out infinite;
    }

    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-6px); }
    }

    /* Welcome message */
    .welcome {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--text-secondary);
    }

    .welcome-icon {
      width: 60px;
      height: 60px;
      margin: 0 auto 1.5rem;
      background: var(--accent-green-dim);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .welcome-icon svg {
      width: 30px;
      height: 30px;
      stroke: var(--accent-green);
    }

    .welcome h2 {
      font-size: 1.3rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .welcome p {
      font-size: 0.95rem;
      margin-bottom: 1.5rem;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    .suggestion {
      padding: 0.6rem 1rem;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      font-size: 0.85rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .suggestion:hover {
      border-color: var(--accent-green);
      color: var(--accent-green);
    }

    /* Input area */
    .input-area {
      padding: 1.5rem 0 2rem;
      border-top: 1px solid var(--border-subtle);
      background: linear-gradient(to top, var(--bg-deep) 0%, transparent 100%);
    }

    .input-wrapper {
      display: flex;
      gap: 0.75rem;
      align-items: flex-end;
    }

    .input-container {
      flex: 1;
      position: relative;
    }

    #message-input {
      width: 100%;
      padding: 1rem 1.25rem;
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      color: var(--text-primary);
      font-family: 'Outfit', sans-serif;
      font-size: 0.95rem;
      resize: none;
      outline: none;
      transition: all 0.2s ease;
      min-height: 52px;
      max-height: 150px;
    }

    #message-input::placeholder {
      color: var(--text-muted);
    }

    #message-input:focus {
      border-color: var(--accent-green);
      box-shadow: 0 0 0 3px var(--accent-green-dim);
    }

    .send-btn {
      width: 52px;
      height: 52px;
      background: var(--accent-green);
      border: none;
      border-radius: 16px;
      color: #000;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .send-btn:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 5px 20px var(--accent-green-dim);
    }
    textarea {
      overflow-y: hidden;
    }
    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .send-btn svg {
      width: 22px;
      height: 22px;
    }

    /* Disclaimer */
    .disclaimer {
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 1rem;
    }

    /* Error state */
    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: var(--error);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 0.85rem;
      margin-bottom: 1rem;
    }

    /* Rate limit warning */
    .rate-limit {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: #f59e0b;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 0.85rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .header {
        padding: 1rem;
      }

      .chat-container {
        padding: 0 0.75rem;
      }

      .message-content {
        max-width: 85%;
      }

      .suggestions {
        flex-direction: column;
        align-items: stretch;
      }

      .suggestion {
        text-align: center;
      }
    }
    /* Prompt Suggestions Bar */
  .prompt-bar {
    position: sticky;
    bottom: 110px; /* sits above input area */
    z-index: 20;
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem 0.25rem;
    overflow-x: auto;
    scrollbar-width: none;
  }

  .prompt-bar::-webkit-scrollbar {
    display: none;
  }

  .prompt-chip {
    white-space: nowrap;
    padding: 0.6rem 1rem;
    background: var(--bg-elevated);
    border: 1px solid var(--border-subtle);
    border-radius: 999px;
    font-size: 0.8rem;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .prompt-chip:hover {
    border-color: var(--accent-green);
    color: var(--accent-green);
    background: rgba(16, 185, 129, 0.08);
  }

  </style>
</head>
<body>
  <div class="bg-gradient"></div>
  <div class="noise"></div>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <a href="index.html" class="back-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5"/>
          <path d="M12 19l-7-7 7-7"/>
        </svg>
        Back
      </a>
    </div>
    <div class="header-title">
      <div class="status-dot"></div>
      <div>
        <h1>Krish's Assistant</h1>
        <span class="header-subtitle">Ask me anything about Krish</span>
      </div>
    </div>
    <div style="width: 80px;"></div> <!-- Spacer for centering -->
  </header>

  <!-- Chat Container -->
  <main class="chat-container">
    <div class="messages" id="messages">
      <!-- Welcome message -->
      <div class="welcome" id="welcome">
        <div class="welcome-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
          </svg>
        </div>
        <h2>Hey there! ðŸ‘‹</h2>
        <p>I'm an AI assistant that can answer questions about Krish's background, experience, projects, and interests.</p>
        <!-- <div class="suggestions">
          <button class="suggestion" onclick="askSuggestion(this)">What's Krish studying?</button>
          <button class="suggestion" onclick="askSuggestion(this)">Tell me about his projects</button>
          <button class="suggestion" onclick="askSuggestion(this)">What are his technical skills?</button>
          <button class="suggestion" onclick="askSuggestion(this)">What's he looking for?</button>
        </div> -->
      </div>
    </div>
    <!-- Persistent Suggestions Bar -->
    <div class="prompt-bar" id="prompt-bar">
      <button class="prompt-chip" onclick="askSuggestion(this)">What's Krish studying?</button>
      <button class="prompt-chip" onclick="askSuggestion(this)">Tell me about his projects</button>
      <button class="prompt-chip" onclick="askSuggestion(this)">What are his technical skills?</button>
      <button class="prompt-chip" onclick="askSuggestion(this)">What is he looking for?</button>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div id="error-container"></div>
      <div class="input-wrapper">
        <div class="input-container">
          <textarea 
            id="message-input" 
            placeholder="Ask about Krish's experience, projects, skills..."
            rows="1"
            onkeydown="handleKeydown(event)"
            style="overflow-y=hidden" 
            oninput="autoResize(this)"
          ></textarea>
        </div>
        <button class="send-btn" id="send-btn" onclick="sendMessage()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"/>
            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
          </svg>
        </button>
      </div>
      <p class="disclaimer">
        This assistant only answers questions about Krish based on provided information. It cannot browse the web or access external data.
      </p>
    </div>
  </main>

  <script>
    // Configuration
    const API_URL = 'https://web-production-12eeb.up.railway.app/chat'; // Change to your deployed URL
    const MAX_MESSAGE_LENGTH = 500;
    const RATE_LIMIT_MESSAGES = 20;
    const RATE_LIMIT_WINDOW = 60000; // 1 minute

    // State
    let messageTimestamps = [];
    let isLoading = false;

    // Auto-resize textarea
    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
    }

    // Handle keyboard
    function handleKeydown(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    // Click suggestion
    function askSuggestion(btn) {
      document.getElementById('message-input').value = btn.textContent;
      sendMessage();
    }

    // Check rate limit
    function checkRateLimit() {
      const now = Date.now();
      messageTimestamps = messageTimestamps.filter(t => now - t < RATE_LIMIT_WINDOW);
      return messageTimestamps.length < RATE_LIMIT_MESSAGES;
    }

    // Show error
    function showError(message) {
      const container = document.getElementById('error-container');
      container.innerHTML = `<div class="error-message">${message}</div>`;
      setTimeout(() => container.innerHTML = '', 5000);
    }

    // Add message to chat
    function addMessage(content, isUser, sources = null) {
      const messages = document.getElementById('messages');
      const welcome = document.getElementById('welcome');
      
      if (welcome) welcome.style.display = 'none';

      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
      
      const avatar = isUser ? 
        `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>` :
        `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
        </svg>`;

      let sourcesHtml = '';
      if (sources && sources.length > 0) {
        sourcesHtml = `<div class="message-meta">Sources: ${sources.join(', ')}</div>`;
      }

      messageDiv.innerHTML = `
        <div class="message-avatar">${avatar}</div>
        <div class="message-content">
          <div class="message-bubble">${escapeHtml(content)}</div>
          ${sourcesHtml}
        </div>
      `;

      messages.appendChild(messageDiv);
      messages.scrollTop = messages.scrollHeight;
    }

    // Add typing indicator
    function showTyping() {
      const messages = document.getElementById('messages');
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message assistant';
      typingDiv.id = 'typing';
      typingDiv.innerHTML = `
        <div class="message-avatar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
          </svg>
        </div>
        <div class="message-content">
          <div class="typing-indicator">
            <span></span><span></span><span></span>
          </div>
        </div>
      `;
      messages.appendChild(typingDiv);
      messages.scrollTop = messages.scrollHeight;
    }

    // Remove typing indicator
    function hideTyping() {
      const typing = document.getElementById('typing');
      if (typing) typing.remove();
    }

    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Send message
    async function sendMessage() {
      const input = document.getElementById('message-input');
      const sendBtn = document.getElementById('send-btn');
      const message = input.value.trim();

      if (!message || isLoading) return;

      // Validate message length
      if (message.length > MAX_MESSAGE_LENGTH) {
        showError(`Message too long. Maximum ${MAX_MESSAGE_LENGTH} characters allowed.`);
        return;
      }

      // Check rate limit
      if (!checkRateLimit()) {
        showError('Too many messages. Please wait a moment before sending more.');
        return;
      }

      // Update state
      isLoading = true;
      sendBtn.disabled = true;
      messageTimestamps.push(Date.now());

      // Add user message
      addMessage(message, true);
      input.value = '';
      autoResize(input);

      // Show typing
      showTyping();

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question: message })
        });

        if (!response.ok) {
          throw new Error('Failed to get response');
        }

        const data = await response.json();
        hideTyping();
        addMessage(data.answer, false, data.sources);

      } catch (error) {
        hideTyping();
        addMessage("Sorry, I'm having trouble connecting right now. Please try again later.", false);
      }

      isLoading = false;
      sendBtn.disabled = false;
      // input.focus();
    }
  </script>
</body>
</html>
